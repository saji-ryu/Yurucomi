{"version":3,"sources":["../../src/server/routes/sessionCheck.ts"],"names":["router","express","Router","debug","get","req","res","session","userName","response","axios","userList","data","pages","map","ele","title","toLowerCase","index","findIndex","json","result","name","icon","image"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;;;;;;;;AAFA,IAAMA,MAAsB,GAAGC,iBAAQC,MAAR,EAA/B;;AAIA,IAAMC,KAAK,GAAG,qBAAO,4BAAP,CAAd;AAEAH,MAAM,CAACI,GAAP,CAAW,GAAX;AAAA;AAAA;AAAA,+BAAgB,WAAOC,GAAP,EAA6BC,GAA7B,EAAuD;AACrE,QAAID,GAAG,CAACE,OAAR,EAAiB;AACf,UAAIF,GAAG,CAACE,OAAJ,CAAYC,QAAhB,EAA0B;AACxBL,QAAAA,KAAK,wBAAiBE,GAAG,CAACE,OAAJ,CAAYC,QAA7B,EAAL;AACA,YAAMC,QAAQ,SAASC,eAAMN,GAAN,CACrB,wCADqB,CAAvB;AAGA,YAAMO,QAAuB,GAAGF,QAAQ,CAACG,IAAT,CAAcC,KAAd,CAAoBC,GAApB,CAC9B,UAACC,GAAD,EAAiC;AAC/B,iBAAOA,GAAG,CAACC,KAAJ,CAAUC,WAAV,EAAP;AACD,SAH6B,CAAhC;AAKA,YAAMC,KAAK,GAAGP,QAAQ,CAACQ,SAAT,CAAmB,UAAAJ,GAAG,EAAI;AACtC,cAAIV,GAAG,CAACE,OAAR,EAAiB;AACf,mBAAOQ,GAAG,KAAKV,GAAG,CAACE,OAAJ,CAAYC,QAA3B;AACD;;AACD,iBAAO,KAAP;AACD,SALa,CAAd;;AAMA,YAAIU,KAAK,IAAI,CAAb,EAAgB;AACdZ,UAAAA,GAAG,CAACc,IAAJ,CAAS;AACPC,YAAAA,MAAM,EAAE,IADD;AAEPC,YAAAA,IAAI,EAAEjB,GAAG,CAACE,OAAJ,CAAYC,QAFX;AAGPe,YAAAA,IAAI,EAAEd,QAAQ,CAACG,IAAT,CAAcC,KAAd,CAAoBK,KAApB,EAA2BM;AAH1B,WAAT;AAKD,SAND,MAMO;AACLrB,UAAAA,KAAK,CAAC,cAAD,CAAL;AACAG,UAAAA,GAAG,CAACc,IAAJ,CAAS;AAAEC,YAAAA,MAAM,EAAE,KAAV;AAAiBC,YAAAA,IAAI,EAAE;AAAvB,WAAT;AACD;AACF,OA1BD,MA0BO;AACLnB,QAAAA,KAAK,CAAC,YAAD,CAAL;AACAG,QAAAA,GAAG,CAACc,IAAJ,CAAS;AAAEC,UAAAA,MAAM,EAAE,KAAV;AAAiBC,UAAAA,IAAI,EAAE;AAAvB,SAAT;AACD;AACF,KA/BD,MA+BO;AACLnB,MAAAA,KAAK,CAAC,YAAD,CAAL;AACAG,MAAAA,GAAG,CAACc,IAAJ,CAAS;AAAEC,QAAAA,MAAM,EAAE,KAAV;AAAiBC,QAAAA,IAAI,EAAE;AAAvB,OAAT;AACD;AACF,GApCD;;AAAA;AAAA;AAAA;AAAA;eAsCetB,M","sourcesContent":["import express from \"express\";\nconst router: express.Router = express.Router();\nimport _debug from \"debug\";\nimport axios from \"axios\";\n\nconst debug = _debug(\"server:router/sessionCheck\");\n\nrouter.get(\"/\", async (req: express.Request, res: express.Response) => {\n  if (req.session) {\n    if (req.session.userName) {\n      debug(`session name:${req.session.userName}`);\n      const response = await axios.get(\n        \"https://scrapbox.io/api/pages/yurucomi\"\n      );\n      const userList: Array<string> = response.data.pages.map(\n        (ele: { [key: string]: any }) => {\n          return ele.title.toLowerCase();\n        }\n      );\n      const index = userList.findIndex(ele => {\n        if (req.session) {\n          return ele === req.session.userName;\n        }\n        return false;\n      });\n      if (index >= 0) {\n        res.json({\n          result: true,\n          name: req.session.userName,\n          icon: response.data.pages[index].image,\n        });\n      } else {\n        debug(\"no such user\");\n        res.json({ result: false, name: null });\n      }\n    } else {\n      debug(\"no session\");\n      res.json({ result: false, name: null });\n    }\n  } else {\n    debug(\"no session\");\n    res.json({ result: false, name: null });\n  }\n});\n\nexport default router;\n"],"file":"sessionCheck.js"}